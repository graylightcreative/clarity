# Source Code Directory

**NGN Clarity C++ Plugin Implementation**

---

## Directory Structure

```
Source/
├── Core/           # AudioProcessor, plugin parameters, state management
├── DSP/            # Audio analysis, ONNX inference, DSP algorithms
├── GUI/            # JUCE UI components, visualization, windows
├── Licensing/      # Vault HMAC, license activation, anti-piracy
├── Telemetry/      # Pulse client, data collection, anonymization
└── Utils/          # Logging, math utilities, helpers
```

---

## Core/

**Audio processor and plugin state**

- `PluginProcessor.h/cpp` - Main plugin class (inherits juce::AudioProcessor)
- `PluginParameters.h/cpp` - Parameter definitions and state handling
- `Config.h` - Plugin version, metadata, constants

---

## DSP/

**Digital Signal Processing and AI**

- `AudioAnalyzer.h/cpp` - Real-time audio analysis (FFT, loudness, features)
- `OnnxSessionManager.h/cpp` - ONNX Runtime session management
- `InferencePipeline.h/cpp` - Audio → model → recommendations flow
- `DSPAlgorithms.h/cpp` - FFT, frequency analysis, signal processing

---

## GUI/

**User Interface (JUCE Components)**

- `EditorWindow.h/cpp` - Main plugin window
- `SpectrumAnalyzer.h/cpp` - Real-time frequency visualization
- `AdviceComponent.h/cpp` - Display mixing recommendations
- `LicenseDialog.h/cpp` - License entry & activation UI
- `LookAndFeel.h/cpp` - Custom theme & styling
- `Components/` - Reusable UI components (meters, sliders, buttons)

---

## Licensing/

**Vault Integration & License Management**

- `HMAC_Keys.h.in` - Template for obfuscated secret key (generated by CMake)
- `HMACKeyManager.h/cpp` - HMAC-SHA256 computation & key de-obfuscation
- `ActivationClient.h/cpp` - REST API client for license activation
- `HardwareIDGenerator.h/cpp` - Machine fingerprinting (Windows/macOS)
- `LicenseManager.h/cpp` - License file I/O and validation
- `OfflineActivation.h/cpp` - Generate/parse .ngn_req/.ngn_lic files

See: `docs/bible/12 - NGN Clarity API Specifications` (Vault section)

---

## Telemetry/

**Pulse Integration & Data Collection**

- `PulseClient.h/cpp` - Telemetry ingest client
- `TelemetryData.h/cpp` - Data structures (cpu_usage, buffer_size, etc.)
- `Anonymizer.h/cpp` - Hash hardware ID, remove PII
- `ConsentManager.h/cpp` - Track user opt-in/opt-out preference

See: `docs/bible/11 - Graylight G-Fleet Integration` (Pulse section)

---

## Utils/

**Utilities & Helpers**

- `Logger.h/cpp` - Logging with levels (debug, info, warning, error)
- `Math.h/cpp` - Audio math (dB conversions, frequency mappings)
- `Network.h/cpp` - HTTP error handling, retry logic
- `StringUtils.h/cpp` - String formatting, escaping

---

## Build & Compilation

All source files are compiled via CMake:

```bash
cmake .. -DCMAKE_BUILD_TYPE=Release
cmake --build .
```

**Output**: `build/bin/NGN_Clarity.vst3`

---

## Code Standards

- **C++17** standard required
- **Const-correct** and exception-safe
- **Secure-by-default** (especially in Licensing/)
- **No global state** (except logging)
- **Memory management**: Smart pointers (unique_ptr, shared_ptr)
- **OpenSSL OPENSSL_cleanse** for sensitive data

---

## Dependencies

| Library | Version | Purpose |
|---------|---------|---------|
| JUCE | 7.0+ | UI framework, audio processing |
| ONNX Runtime | 1.18+ | AI model inference |
| OpenSSL | 1.1+ | HMAC-SHA256, cryptography |
| libcurl | 7.8+ | HTTP API communication |
| nlohmann/json | 3.0+ | JSON parsing |

---

## Phases Using This Directory

| Phase | Components | Duration |
|-------|-----------|----------|
| PHASE_0 | Structure, CMake | 1 week |
| PHASE_1 | Core/, DSP/ | 4 weeks |
| PHASE_2 | GUI/ | 3 weeks |
| PHASE_2A | Licensing/ | 2 weeks |
| PHASE_4 | GUI/ updates | 3 weeks |
| PHASE_5 | Telemetry/ | 2 weeks |

---

**Maintained By**: Graylight Creative Engineering Team
**Last Updated**: February 11, 2025
